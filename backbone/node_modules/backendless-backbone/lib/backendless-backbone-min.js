(function(e){var t=typeof self==="object"&&self.self===self&&self||typeof global==="object"&&global.global===global&&global;if(typeof define==="function"&&define.amd){define(["backendless","backbone","underscore"],function(s,i,n){e(t,s,i,n)})}else if(typeof exports!=="undefined"){var s=require("backendless"),i=require("underscore"),n=require("backbone");e(t,s,n,i)}else{e(t,t.Backendless,t.Backbone,t._)}})(function(e,t,s,i){var n="/properties";var a="___class";var r="objectId";t.extendAjaxOptionsByBackendlessHeaders=l;(function(){var e={props:"properties",loadRelations:"relations",relationsDepth:"relationsDepth",sortBy:"sortingBy",where:"condition"};var t=s.Model;var n=s.Model.prototype;var l={schemaName:null,schemaTypes:null,properties:null,relations:null,relationsDepth:null,sortingBy:null,condition:null};s.Model=t.extend({constructor:function(e,s){s=s||{};var n=this.schemaName||s.schemaName||s.collection&&s.collection.schemaName;if(!n&&!i.isEmpty(e)){n=e[a]}if(n){e=i.clone(e)||{};e[a]=this.schemaName=n;i.defaults(this,l);this.idAttribute=r;this.schemaTypes=this.schemaTypes||s.schemaTypes}t.call(this,e,s)},urlRoot:function(){if(this.schemaName){return h(this.schemaName)}},getUrlParams:function(t){return c(this,e,t)},describe:function(e){if(this.schemaName){return f(this,e)}},toClasses:function(e,t){if(!this.schemaName||e instanceof s.Model||e instanceof s.Collection){return e}if(i.isArray(e)){var n=e.length&&e[0][a]||this.schemaTypes&&this.schemaTypes[t];if(n){return this.updateRelatedItem(e,t,n,s.Collection)}i.each(e,function(t,s){e[s]=this.toClasses(t,s)},this)}else if(i.isObject(e)){var r=e[a]||this.schemaTypes&&this.schemaTypes[t];if(r){return this.updateRelatedItem(e,t,r,s.Model)}i.each(e,function(t,s){e[s]=this.toClasses(t,s)},this)}return e},updateRelatedItem:function(e,t,n,r){var o=this.get(t);var l=this;if(!o||!(o instanceof r)){o=new r(null,{schemaName:n});o.on("all",function(){var e=Array.prototype.slice.call(arguments);e[0]=t+"."+e[0];l.trigger.apply(l,e)})}if(o instanceof s.Collection){o.set(e)}else{var c={};i.each(o.attributes,function(t,s){if(!e[s]&&s!==a){c[s]=undefined}});o.set(c,{unset:true});o.set(e)}return o},fetch:function(e){e=i.clone(e)||{};if(this.schemaName){if(e.id){this.set(r,e.id)}else if(e.isLast){this.unset(r)}e.url=i.result(this,"url");if(!this.id){if(e.isLast){e.url+="/last"}else{e.url+="/first"}}e.url+=u(this.getUrlParams(e))}return n.fetch.call(this,e)},set:function(e,t,s){if(e==null)return this;var a;if(typeof e==="object"){a=e;s=t}else{(a={})[e]=t}if(this.schemaName){a=i.mapObject(a,this.toClasses,this)}return n.set.call(this,a,s)},sync:function(e,t,s){if(this.schemaName){if(e==="patch"){e="update"}return m(e,t,s)}return n.sync(e,t,s)},toJSON:function(){return o(this.attributes)}})})();(function(){var e={offset:"offsetItems",pageSize:"itemsPerPage",props:"properties",loadRelations:"relations",relationsDepth:"relationsDepth",sortBy:"sortingBy",where:"condition"};var t=s.Collection;var n=s.Collection.prototype;var o={totalItems:null,offsetItems:0,itemsPerPage:10,properties:null,relations:null,relationsDepth:null,sortingBy:null,condition:null};s.Collection=t.extend({model:s.Model,constructor:function(e,n){var r=this.schemaName||n&&n.schemaName||this.model.prototype.schemaName;if(!r&&!i.isEmpty(e)){r=e[0]instanceof s.Model?e[0].schemaName:e[0][a]}if(r){i.defaults(i.extend(this,{schemaName:r}),o)}t.call(this,e,n)},getUrlParams:function(t){if(this.schemaName){return c(this,e,t)}},describe:function(e){if(this.schemaName){return f(this,e)}},modelId:function(e){var t=this.schemaName?r:this.model.prototype.idAttribute;return e[t||"id"]},url:function(){if(this.schemaName){return h(this.schemaName)}},fetch:function(e){if(this.schemaName){e=i.clone(e)||{};e.url=i.result(this,"url")+u(this.getUrlParams(e))}return n.fetch.call(this,e)},parse:function(e){if(this.schemaName){this.offsetItems=e.offset;this.totalItems=e.totalObjects;return e.data}return e},sync:function(e,t,s){return this.schemaName?m(e,t,s):n.sync(e,t,s)}})})();function o(e){return i[i.isArray(e)?"map":"mapObject"](e,function(e){if(e instanceof s.Model||e instanceof s.Collection){return e.toJSON()}else if(i.isObject(e)){return o(e)}return e})}function l(e){var s=t.LocalCache.get("user-token");var i=e.headers=e.headers||{};i["application-type"]="JS";i["application-id"]=t.applicationId;i["secret-key"]=t.secretKey;if(s){i["user-token"]=s}return e}function c(e,t,s){var n={};i.each(t,function(t,a){var r=s&&s[t];var o=r!==undefined?r:i.result(e,t);if(o!=null){n[a]=o}});return n}function u(e){var t=i.map(e,function(e,t){return t+"="+e}).join("&");return t?"?"+encodeURI(t):""}function h(e){if(e==="GeoPoint"){return t.appPath+"/geo/points"}return t.appPath+"/data/"+e}function f(e,t){t=i.clone(t)||{};t.url=h(e.schemaName)+n;var s=t.success;t.success=function(t){e.schema=t;e.trigger("schema:loaded");s&&s.apply(e,arguments)};return m("read",e,t)}function m(e,t,i){return s.sync.call(t,e,t,l(i))}});
//# sourceMappingURL=lib/backendless-backbone-min.map